(function($){var defaults={columns:1,search:false,searchOptions:{delay:250,showOptGroups:false,onSearch:function(element){}},texts:{placeholder:"Select options",search:"Search",selectedOptions:" selected",selectAll:"Select all",unselectAll:"Unselect all",noneSelected:"None Selected"},selectAll:false,selectGroup:false,minHeight:200,maxHeight:null,maxWidth:null,maxPlaceholderOpts:10,showCheckbox:true,optionAttributes:[],onLoad:function(element){},onOptionClick:function(element,option){},onControlClose:function(element){},minSelect:false,maxSelect:false};var msCounter=1;if(typeof Array.prototype.map!=="function"){Array.prototype.map=function(callback,thisArg){if(typeof thisArg==="undefined"){thisArg=this}return $.isArray(thisArg)?$.map(thisArg,callback):[]}}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}function MultiSelect(element,options){this.element=element;this.options=$.extend(true,{},defaults,options);this.updateSelectAll=true;this.updatePlaceholder=true;if("placeholder"in this.options){this.options.texts.placeholder=this.options.placeholder;delete this.options.placeholder}if("default"in this.options.searchOptions){this.options.texts.search=this.options.searchOptions["default"];delete this.options.searchOptions["default"]}this.load()}MultiSelect.prototype={load:function(){var instance=this;if(instance.element.nodeName!="SELECT"||$(instance.element).hasClass("jqmsLoaded")){return true}$(instance.element).addClass("jqmsLoaded").data("plugin_multiselect-instance",instance);$(instance.element).after('<div class="ms-options-wrap"><button>None Selected</button><div class="ms-options"><ul></ul></div></div>');var placeholder=$(instance.element).next(".ms-options-wrap").find("> button:first-child");var optionsWrap=$(instance.element).next(".ms-options-wrap").find("> .ms-options");var optionsList=optionsWrap.find("> ul");var hasOptGroup=$(instance.element).find("optgroup").length?true:false;if(!instance.options.showCheckbox){optionsWrap.addClass("hide-checkbox")}if($(instance.element).prop("disabled")){placeholder.prop("disabled",true)}var maxWidth=null;if(typeof instance.options.maxWidth=="number"){optionsWrap.parent().css("position","relative");maxWidth=instance.options.width}else if(typeof instance.options.maxWidth=="string"){$(instance.options.width).css("position","relative");maxWidth="100%"}else{optionsWrap.parent().css("position","relative")}var maxHeight=$(window).height()-optionsWrap.offset().top+$(window).scrollTop()-20;if(instance.options.maxHeight){maxHeight=instance.options.maxHeight}maxHeight=maxHeight<instance.options.minHeight?instance.options.minHeight:maxHeight;optionsWrap.css({maxWidth:maxWidth,minHeight:instance.options.minHeight,maxHeight:maxHeight});optionsWrap.bind("touchmove mousewheel DOMMouseScroll",function(e){if($(this).outerHeight()<$(this)[0].scrollHeight){var e0=e.originalEvent,delta=e0.wheelDelta||-e0.detail;if($(this).outerHeight()+$(this)[0].scrollTop>$(this)[0].scrollHeight){e.preventDefault();this.scrollTop+=delta<0?1:-1}}});$(document).off("click.ms-hideopts").on("click.ms-hideopts",function(event){if(!$(event.target).closest(".ms-options-wrap").length){$(".ms-options-wrap > .ms-options.ms-active").each(function(){$(this).removeClass("ms-active");var thisInst=$(this).parent().prev(".jqmsLoaded").data("plugin_multiselect-instance");if(typeof thisInst.options.onControlClose=="function"){thisInst.options.onControlClose(thisInst.element)}})}});placeholder.bind("mousedown",function(event){if(event.which!=1){return true}$(".ms-options-wrap > .ms-options.ms-active").each(function(){if($(this).parent().prev()[0]!=optionsWrap.parent().prev()[0]){$(this).removeClass("ms-active");var thisInst=$(this).parent().prev(".jqmsLoaded").data("plugin_multiselect-instance");if(typeof thisInst.options.onControlClose=="function"){thisInst.options.onControlClose(thisInst.element)}}});optionsWrap.toggleClass("ms-active");if(optionsWrap.hasClass("ms-active")){optionsWrap.css("maxHeight","");var maxHeight=$(window).height()-optionsWrap.offset().top+$(window).scrollTop()-20;if(instance.options.maxHeight){maxHeight=instance.options.maxHeight}maxHeight=maxHeight<instance.options.minHeight?instance.options.minHeight:maxHeight;optionsWrap.css("maxHeight",maxHeight)}else if(typeof instance.options.onControlClose=="function"){instance.options.onControlClose(instance.element)}}).click(function(event){event.preventDefault()});if(instance.options.texts.placeholder){placeholder.text(instance.options.texts.placeholder)}if(instance.options.search){optionsList.before('<div class="ms-search"><input type="text" value="" placeholder="'+instance.options.texts.search+'" /></div>');var search=optionsWrap.find(".ms-search input");search.on("keyup",function(){if($(this).data("lastsearch")==$(this).val()){return true}if($(this).data("searchTimeout")){clearTimeout($(this).data("searchTimeout"))}var thisSearchElem=$(this);$(this).data("searchTimeout",setTimeout(function(){thisSearchElem.data("lastsearch",thisSearchElem.val());if(typeof instance.options.searchOptions.onSearch=="function"){instance.options.searchOptions.onSearch(instance.element)}var searchString=$.trim(search.val().toLowerCase());if(searchString){optionsList.find('li[data-search-term*="'+searchString+'"]:not(.optgroup)').removeClass("ms-hidden");optionsList.find('li:not([data-search-term*="'+searchString+'"], .optgroup)').addClass("ms-hidden")}else{optionsList.find(".ms-hidden").removeClass("ms-hidden")}if(!instance.options.searchOptions.showOptGroups){optionsList.find(".optgroup").each(function(){if($(this).find("li:not(.ms-hidden)").length){$(this).show()}else{$(this).hide()}})}instance._updateSelectAllText()},instance.options.searchOptions.delay))})}if(instance.options.selectAll){optionsList.before('<a href="#" class="ms-selectall global">'+instance.options.texts.selectAll+"</a>")}optionsWrap.on("click",".ms-selectall",function(event){event.preventDefault();instance.updateSelectAll=false;instance.updatePlaceholder=false;var select=optionsWrap.parent().prev();if($(this).hasClass("global")){if(optionsList.find("li:not(.optgroup, .selected, .ms-hidden)").length){optionsList.find("li:not(.optgroup, .selected, .ms-hidden)").addClass("selected");optionsList.find('li.selected input[type="checkbox"]').prop("checked",true);select.find("option").prop("selected",true)}else{optionsList.find("li:not(.optgroup, .ms-hidden).selected").removeClass("selected");optionsList.find('li:not(.optgroup, .ms-hidden, .selected) input[type="checkbox"]').prop("checked",false);select.find("option").prop("selected",false)}}else if($(this).closest("li").hasClass("optgroup")){var optgroup=$(this).closest("li.optgroup");var optgroupLabel=optgroup.find("> .label").text();if(optgroup.find("li:not(.selected, .ms-hidden)").length){optgroup.find("li:not(.selected, .ms-hidden)").addClass("selected");optgroup.find('li.selected input[type="checkbox"]').prop("checked",true);select.find('optgroup[label="'+optgroupLabel+'"] option').prop("selected",true)}else{optgroup.find("li:not(.ms-hidden).selected").removeClass("selected");optgroup.find('li:not(.ms-hidden, .selected) input[type="checkbox"]').prop("checked",false);select.find('optgroup[label="'+optgroupLabel+'"] option').prop("selected",false)}}instance.updateSelectAll=true;instance.updatePlaceholder=true;instance._updateSelectAllText();instance._updatePlaceholderText()});var options=[];$(instance.element).children().each(function(){if(this.nodeName=="OPTGROUP"){var groupOptions=[];$(this).children("option").each(function(){var thisOptionAtts={};for(var i=0;i<instance.options.optionAttributes.length;i++){var thisOptAttr=instance.options.optionAttributes[i];if($(this).attr(thisOptAttr)!==undefined){thisOptionAtts[thisOptAttr]=$(this).attr(thisOptAttr)}}groupOptions.push({name:$(this).text(),value:$(this).val(),checked:$(this).prop("selected"),attributes:thisOptionAtts})});options.push({label:$(this).attr("label"),options:groupOptions})}else if(this.nodeName=="OPTION"){var thisOptionAtts={};for(var i=0;i<instance.options.optionAttributes.length;i++){var thisOptAttr=instance.options.optionAttributes[i];if($(this).attr(thisOptAttr)!==undefined){thisOptionAtts[thisOptAttr]=$(this).attr(thisOptAttr)}}options.push({name:$(this).text(),value:$(this).val(),checked:$(this).prop("selected"),attributes:thisOptionAtts})}else{return true}});instance.loadOptions(options,true,false);instance._updateSelectAllText(false);optionsWrap.on("click",'input[type="checkbox"]',function(){$(this).closest("li").toggleClass("selected");var select=optionsWrap.parent().prev();select.find('option[value="'+$(this).val()+'"]').prop("selected",$(this).is(":checked")).closest("select").trigger("change");if(typeof instance.options.onOptionClick=="function"){instance.options.onOptionClick(instance.element,this)}instance._updateSelectAllText();instance._updatePlaceholderText()});optionsWrap.on("focusin",'input[type="checkbox"]',function(){$(this).closest("label").addClass("focused")}).on("focusout",'input[type="checkbox"]',function(){$(this).closest("label").removeClass("focused")});if(typeof instance.options.onLoad==="function"){instance.options.onLoad(instance.element)}$(instance.element).hide()},loadOptions:function(options,overwrite,updateSelect){overwrite=typeof overwrite=="boolean"?overwrite:true;updateSelect=typeof updateSelect=="boolean"?updateSelect:true;var instance=this;var optionsList=$(instance.element).next(".ms-options-wrap").find("> .ms-options > ul");var optionsWrap=$(instance.element).next(".ms-options-wrap").find("> .ms-options");var select=optionsWrap.parent().prev();if(overwrite){optionsList.find("> li").remove();if(updateSelect){select.find("> *").remove()}}for(var key in options){if(!options.hasOwnProperty(key)){continue}var thisOption=options[key];var container=$("<li/>");var appendContainer=true;if(thisOption.hasOwnProperty("options")){optionsList.find("> li.optgroup > span.label").each(function(){if($(this).text()==thisOption.label){container=$(this).closest(".optgroup");appendContainer=false}});if(updateSelect){if(select.find('optgroup[label="'+thisOption.label+'"]').length){var optGroup=select.find('optgroup[label="'+thisOption.label+'"]')}else{var optGroup=$('<optgroup label="'+thisOption.label+'"></optgroup>');select.append(optGroup)}}if(appendContainer){container.addClass("optgroup");container.append('<span class="label">'+thisOption.label+"</span>");container.find("> .label").css({clear:"both"});if(instance.options.selectGroup){container.append('<a href="#" class="ms-selectall">'+instance.options.texts.selectAll+"</a>")}container.append("<ul/>")}for(var gKey in thisOption.options){if(!thisOption.options.hasOwnProperty(gKey)){continue}var thisGOption=thisOption.options[gKey];var gContainer=$("<li/>").addClass("ms-reflow");if(!thisGOption.hasOwnProperty("value")){continue}instance._addOption(gContainer,thisGOption);container.find("> ul").append(gContainer);if(updateSelect){var selOption=$('<option value="'+thisGOption.value+'">'+thisGOption.name+"</option>");if(thisGOption.hasOwnProperty("attributes")&&Object.keys(thisGOption.attributes).length){}if(thisGOption.checked){selOption.prop("selected",true)}optGroup.append(selOption)}}}else if(thisOption.hasOwnProperty("value")){container.addClass("ms-reflow");instance._addOption(container,thisOption);if(updateSelect){var selOption=$('<option value="'+thisOption.value+'">'+thisOption.name+"</option>");if(thisOption.hasOwnProperty("attributes")&&Object.keys(thisOption.attributes).length){selOption.attr(thisOption.attributes)}if(thisOption.checked){selOption.prop("selected",true)}select.append(selOption)}}else{continue}if(appendContainer){optionsList.append(container)}}var chkbx=optionsList.find('.ms-reflow input[type="checkbox"]').eq(0);if(chkbx.length&&chkbx.css("display").match(/block$/)){var checkboxWidth=chkbx.outerWidth();checkboxWidth=checkboxWidth?checkboxWidth:15;optionsList.find(".ms-reflow label").css("padding-left",parseInt(chkbx.closest("label").css("padding-left"))*2+checkboxWidth);optionsList.find(".ms-reflow").removeClass("ms-reflow")}instance._updatePlaceholderText();optionsWrap.find("ul").css({"column-count":"","column-gap":"","-webkit-column-count":"","-webkit-column-gap":"","-moz-column-count":"","-moz-column-gap":""});if(select.find("optgroup").length){optionsList.find("> li:not(.optgroup)").css({float:"left",width:100/instance.options.columns+"%"});optionsList.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":instance.options.columns,"column-gap":0,"-webkit-column-count":instance.options.columns,"-webkit-column-gap":0,"-moz-column-count":instance.options.columns,"-moz-column-gap":0});if(this._ieVersion()&&this._ieVersion()<10){optionsList.find("li.optgroup > ul > li").css({float:"left",width:100/instance.options.columns+"%"})}}else{optionsList.css({"column-count":instance.options.columns,"column-gap":0,"-webkit-column-count":instance.options.columns,"-webkit-column-gap":0,"-moz-column-count":instance.options.columns,"-moz-column-gap":0});if(this._ieVersion()&&this._ieVersion()<10){optionsList.find("> li").css({float:"left",width:100/instance.options.columns+"%"})}}},settings:function(options){this.options=$.extend(true,{},this.options,options);this.reload()},unload:function(){$(this.element).next(".ms-options-wrap").remove();$(this.element).show(function(){$(this).css("display","").removeClass("jqmsLoaded")})},reload:function(){$(this.element).next(".ms-options-wrap").remove();$(this.element).removeClass("jqmsLoaded");this.load()},reset:function(){var defaultVals=[];$(this.element).find("option").each(function(){if($(this).prop("defaultSelected")){defaultVals.push($(this).val())}});$(this.element).val(defaultVals);this.reload()},disable:function(status){status=typeof status==="boolean"?status:true;$(this.element).prop("disabled",status);$(this.element).next(".ms-options-wrap").find("button:first-child").prop("disabled",status)},_updateSelectAllText:function(visibleOnly){if(!this.updateSelectAll){return}if(typeof visibleOnly!=="boolean"){visibleOnly=true}var instance=this;if(!instance.options.selectAll&&!instance.options.selectGroup){return}var optionsWrap=$(instance.element).next(".ms-options-wrap").find("> .ms-options");optionsWrap.find(".ms-selectall").each(function(){var unselected=$(this).parent().find("li:not(.optgroup,.selected,.ms-hidden)");$(this).text(unselected.length?instance.options.texts.selectAll:instance.options.texts.unselectAll)})},_updatePlaceholderText:function(){if(!this.updatePlaceholder){return}var instance=this;var placeholder=$(instance.element).next(".ms-options-wrap").find("> button:first-child");var optionsWrap=$(instance.element).next(".ms-options-wrap").find("> .ms-options");var select=optionsWrap.parent().prev();var selectVals=select.val()?select.val():[];var selOpts=[];for(key in selectVals){selOpts.push($.trim(select.find('option[value="'+selectVals[key]+'"]').text()));if(selOpts.length>=instance.options.maxPlaceholderOpts){break}}placeholder.text(selOpts.join(", "));var placeholderElem=placeholder.get(0);if(placeholderElem.scrollWidth>placeholderElem.clientWidth||selOpts.length!=selectVals.length){placeholder.text(select.val().length+instance.options.texts.selectedOptions)}else if(!selOpts.length){placeholder.text(instance.options.texts.placeholder)}},_addOption:function(container,option){var thisOption=$("<label/>",{for:"ms-opt-"+msCounter,text:option.name});var thisCheckbox=$("<input>",{type:"checkbox",title:option.name,id:"ms-opt-"+msCounter,value:option.value});if(option.hasOwnProperty("attributes")&&Object.keys(option.attributes).length){thisCheckbox.attr(option.attributes)}if(option.checked){container.addClass("default selected");thisCheckbox.prop("checked",true)}thisOption.prepend(thisCheckbox);container.attr("data-search-term",$.trim(option.name.toLowerCase())).prepend(thisOption);msCounter=msCounter+1},_ieVersion:function(){var myNav=navigator.userAgent.toLowerCase();return myNav.indexOf("msie")!=-1?parseInt(myNav.split("msie")[1]):false}};$.fn.multiselect=function(options){var args=arguments;var ret;if(options===undefined||typeof options==="object"){return this.each(function(){if(!$.data(this,"plugin_multiselect")){$.data(this,"plugin_multiselect",new MultiSelect(this,options))}})}else if(typeof options==="string"&&options[0]!=="_"&&options!=="init"){this.each(function(){var instance=$.data(this,"plugin_multiselect");if(instance instanceof MultiSelect&&typeof instance[options]==="function"){ret=instance[options].apply(instance,Array.prototype.slice.call(args,1))}if(options==="unload"){$.data(this,"plugin_multiselect",null)}});return ret}}})(jQuery);